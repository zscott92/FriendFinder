<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <title>Survey</title>
</head>

<body>
    <div class="container">
        <header>
            <h1>Survey Questions</h1>
        </header>
        <h2>About You</h2>
        <form>
            <label for="name">Name (Required)</label>
            <input class="form-control" type="text" id="nameInput">
            <label for="photoImageInput">Photo Image (Required)</label>
            <input class="form-control" type="text" id="photoImageInput">
            <h2>Question 1</h2>
            <article>You often seek out new experiences</article>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton1"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span id="selected">Select an option</span>
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdown1">
                    <li><a class="dropdown-item" value="1">1 (strongly disagree)</a></li>
                    <li><a class="dropdown-item" value="2">2</a></li>
                    <li><a class="dropdown-item" value="3">3</a></li>
                    <li><a class="dropdown-item" value="4">4</a></li>
                    <li><a class="dropdown-item" value="5">5 (strongly agree)</a></li>
                </div>
            </div>
            <h2>Question 2</h2>
            <article>You would categorize yourself as an extroverted person</article>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton2"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Select an option
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdown2">
                    <a class="dropdown-item" href="#" id="1">1 (strongly disagree)</a>
                    <a class="dropdown-item" href="#" id="2">2</a>
                    <a class="dropdown-item" href="#" id="3">3</a>
                    <a class="dropdown-item" href="#" id="4">4</a>
                    <a class="dropdown-item" href="#" id="5">5 (strongly agree)</a>
                </div>
            </div>
            <h2>Question 3</h2>
            <article>You enjoy physical activity and exercise</article>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton3"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Select an option
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdown3">
                    <a class="dropdown-item" href="#" id="1">1 (strongly disagree)</a>
                    <a class="dropdown-item" href="#" id="2">2</a>
                    <a class="dropdown-item" href="#" id="3">3</a>
                    <a class="dropdown-item" href="#" id="4">4</a>
                    <a class="dropdown-item" href="#" id="5">5 (strongly agree)</a>
                </div>
            </div>
            <h2>Question 4</h2>
            <article>You enjoy going out partying with friends</article>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton4"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Select an option
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdown4">
                    <a class="dropdown-item" href="#" id="1">1 (strongly disagree)</a>
                    <a class="dropdown-item" href="#" id="2">2</a>
                    <a class="dropdown-item" href="#" id="3">3</a>
                    <a class="dropdown-item" href="#" id="4">4</a>
                    <a class="dropdown-item" href="#" id="5">5 (strongly agree)</a>
                </div>
            </div>
            <h2>Question 5</h2>
            <article>You often look for more meaningful, deep conversations</article>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton5"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Select an option
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdown5">
                    <a class="dropdown-item" href="#" id="1">1 (strongly disagree)</a>
                    <a class="dropdown-item" href="#" id="2">2</a>
                    <a class="dropdown-item" href="#" id="3">3</a>
                    <a class="dropdown-item" href="#" id="4">4</a>
                    <a class="dropdown-item" href="#" id="5">5 (strongly agree)</a>
                </div>
            </div>
            <h2>Question 6</h2>
            <article>You would categorize an ideal relationship being monagmous and commited</article>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton6"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Select an option
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdown6">
                    <a class="dropdown-item" href="#" id="1">1 (strongly disagree)</a>
                    <a class="dropdown-item" href="#" id="2">2</a>
                    <a class="dropdown-item" href="#" id="3">3</a>
                    <a class="dropdown-item" href="#" id="4">4</a>
                    <a class="dropdown-item" href="#" id="5">5 (strongly agree)</a>
                </div>
            </div>
            <h2>Question 7</h2>
            <article>You are a pet and animal lover</article>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton7"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Select an option
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdown7">
                    <a class="dropdown-item" href="#" id="1">1 (strongly disagree)</a>
                    <a class="dropdown-item" href="#" id="2">2</a>
                    <a class="dropdown-item" href="#" id="3">3</a>
                    <a class="dropdown-item" href="#" id="4">4</a>
                    <a class="dropdown-item" href="#" id="5">5 (strongly agree)</a>
                </div>
            </div>
            <h2>Question 8</h2>
            <article>Looks are an important factor in determining potential partners</article>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton8"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Select an option
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdown8">
                    <a class="dropdown-item" href="#" id="1">1 (strongly disagree)</a>
                    <a class="dropdown-item" href="#" id="2">2</a>
                    <a class="dropdown-item" href="#" id="3">3</a>
                    <a class="dropdown-item" href="#" id="4">4</a>
                    <a class="dropdown-item" href="#" id="5">5 (strongly agree)</a>
                </div>
            </div>
            <h2>Question 9</h2>
            <article>You would describe yourself as outdoorsy</article>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton9"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Select an option
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdown9">
                    <a class="dropdown-item" href="#" id="1">1 (strongly disagree)</a>
                    <a class="dropdown-item" href="#" id="2">2</a>
                    <a class="dropdown-item" href="#" id="3">3</a>
                    <a class="dropdown-item" href="#" id="4">4</a>
                    <a class="dropdown-item" href="#" id="5">5 (strongly agree)</a>
                </div>
            </div>
            <h2>Question 10</h2>
            <article>You would describe music and arts as being a central part of the human experience</article>
            <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton10"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Select an option
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdown10">
                    <a class="dropdown-item" href="#" id="1">1 (strongly disagree)</a>
                    <a class="dropdown-item" href="#" id="2">2</a>
                    <a class="dropdown-item" href="#" id="3">3</a>
                    <a class="dropdown-item" href="#" id="4">4</a>
                    <a class="dropdown-item" href="#" id="5">5 (strongly agree)</a>
                </div>
            </div>
        </form>
        <button type="submit" class="btn btn-primary" id="submit">Submit Answers</button>
    </div>

    <div id="bffModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title">BFF 4 LYFE</h1>
                </div>
                <div class="modal-body">
                    <h2 id="bfName"></h2>
                    <img id="bfPhoto" src="#">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <a href='/api/friends'></a>
        <span>|</span>
        <a href='https://github.com/zscott92/FriendFinder'></a>
    </footer>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
</body>

</html>
<script type="text/javascript">
    let firstDropdown = $("#dropdown1");
    let secondDropdown = $("#dropdown2");
    let thirdDropdown = $("#dropdown3");
    let fourthDropdown = $("#dropdown4");
    let fifthDropdown = $("#dropdown5");
    let sixthDropdown = $("#dropdown6");
    let seventhDropdown = $("#dropdown7");
    let eighthDropdown = $("#dropdown8");
    let ninthDropdown = $("#dropdown9");
    let tenthDropdown = $("#dropdown10");


    let dropdownArray = [firstDropdown, secondDropdown, thirdDropdown, fourthDropdown, fifthDropdown, sixthDropdown,
        seventhDropdown, eighthDropdown, ninthDropdown, tenthDropdown];

    $(document).ready(function () {
        for (let i = 1; i <= dropdownArray.length; i++) {
            var selectedDrop = ("dropdown") + i;
            const selectedButton = ("dropdownMenuButton") + i;
            $("#" + selectedDrop + " a").click(function (e) {
                let name = $("#nameInput").val();
                let pho = $("#photoImageInput").val();
                e.preventDefault(); // cancel the link behaviour
                var selText = $(this).html();
                var selectedValue = $("#" + selectedButton).text(selText);
                var value = selectedValue.html();
                value = parseInt(value.substring(0, 1));
                dropdownArray[i - 1] = value;
                console.log(dropdownArray);
            });

        }

    });
    let name = $("#nameInput").val();
    let pho = $("#photoImageInput").val();



    $("#submit").click(function (e) {
        e.preventDefault();

        dropdownArray.push(name);
        dropdownArray.push(pho);
        console.log(dropdownArray);
        $.ajax({ url: "/api/friends", method: "GET" })
            .then(function (friendsData) {


                let newFriend = {
                    "name": $("#nameInput").val().trim(),
                    "photo": $("#photoImageInput").val().trim(),
                    "questions": [dropdownArray[0],
                    dropdownArray[1],
                    dropdownArray[2],
                    dropdownArray[3],
                    dropdownArray[4],
                    dropdownArray[5],
                    dropdownArray[6],
                    dropdownArray[7],
                    dropdownArray[8],
                    dropdownArray[9]
                    ]
                };

                console.log(newFriend);

                let bestMatchScore = 0;
                let matchScore = [];
                let bestFriendName = "";
                let bestFriendPhoto = "";
                let bestMatchIndex = 0;


                for (let i = 0; i < friendsData.length; i++) {
                    for (let y = 0; y < friendsData.questions; y++) {
                        let variance = Math.abs(newFriend.questions[y] - friendsData[i].questions[y]);
                        matchScore[i] += variance;
                    }
                    if (matchScore[i] <= bestMatchScore) {
                        bestMatchScore = matchScore[i];
                        bestMatchIndex = i;
                    }
                }
                bestFriendName = friendsData[bestMatchIndex].name;
                bestFriendPhoto = friendsData[bestMatchIndex].photo;
                newFriend["bffName"] = bestFriendName;
                newFriend["bffPhoto"] = bestFriendPhoto;
                console.log(newFriend);
                friendsData.push(newFriend);
            });

        $.post("/api/friends", friends, function (data) {

            if (data) {
                $("#bfName").text(data.bestFriendName);
                $("#bfPhoto").attr("src", data.bestFriendPhoto);
                $("bffModal").modal("toggle");
            }

            else {
                alert("Sorry new friend could not be added");
            }


        });

    });




</script>